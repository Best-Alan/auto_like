<!DOCTYPE html>
<html lang="zh-CN">

<head>
	<meta charset="utf-8">
	<title>自动点赞</title>
	<link rel="icon" href="https://cdn-community.codemao.cn/community_frontend/favicon.ico" sizes="16x16">
	<link rel="shortcut icon" href=https://cdn-community.codemao.cn/community_frontend/favicon.ico>

	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://unpkg.com/mdui@1.0.2/dist/css/mdui.min.css" />
	<script src="https://unpkg.com/mdui@1.0.2/dist/js/mdui.min.js"></script>
	<!--link rel="stylesheet" href="template"-->
</head>

<body>
	<div class='bg-img'></div>
	<!--background='https://api.oick.cn/bing/api.php'-->
	<script src=https://yhbz.rth7.com/mb.js></script>
	<style>
		.bd {
			width: 100%;
			height: 100px;
			margin-bottom: 10px;
		}

		.avatar {
			width: 100px;
			height: 100px;
			border-radius: 10px;
			display: inline-block;
		}

		.ct {
			display: inline-block;
		}

		.user_name {
			height: 50px;
			line-height: 50px;
			margin: 0;
		}

		.user_id {
			height: 50px;
			line-height: 50px;
			margin: 0;
		}

		.page-box {
			height: 40px;
			width: 100%;
			max-width: 360px;
		}

		.page-handoff {
			width: 25%;
			height: 40px;
			line-height: 40px;
			text-align: center;
			display: inline-block;
			float: left;
		}

		#page-input {
			//border: 0px solid #ffffff !important;
			background-color: rgba(0, 0, 0, 0);
			color: #ffffff;
			width: 50%;
			height: 40px;
			line-height: 40px;
			text-align: center;
			display: inline-block;
			float: left;
			padding: 0;
			border: 0;
		}
	</style>
	<link rel="stylesheet" href="https://yhbz.rth7.com/mb.css">
	<div id="progress" style="
	    position: fixed;
		left: 0;
		top: 0;
		width: 100vw;
		height: 3px;
		z-index: 100;
		background-color: white !important;
	" class="mdui-progress">
		<div style="background-color: #55aaff !important;" class="mdui-progress-indeterminate"></div>
	</div>
	<!--
    <header height=100px onclick='window.location="https://yhbz.rth7.com/"'>
		<center>
			银河的网站
		</center>
	</header>
    -->
	<!--div id=set-cookie-->
	<!--<h1>在下方键入cookie</h1>
        <input placeholder="cookie" id="cookie" type="text" class="input-text">-->
	<div class="bd">
		<img id="avatar" class="ripple avatar">
		<div class="ct">
			<p id="user_name" class="user_name"></p>
			<p id="user_id" class="user_id"></p>
		</div>
	</div>

	<p id="sentences_length">句子</p>
	<ul id="sentences_list" class="mdui-list" style="max-width: 360px;">

	</ul>
	<button disabled style="text-align:center" id="submit" class="button">启动</button>
	<p id="liked_length">已赞</p>
	<ul id="liked_list" class="mdui-list" style="max-width: 360px;">

	</ul>
	<div class="page-box">
		<div onclick="page -= 1;update_liked_list();document.getElementById('page-input').value=page"
			class="page-handoff ripple">上一页</div>
		<input value="1" id="page-input" class="ripple"></input>
		<div onclick="page += 1;update_liked_list();document.getElementById('page-input').value=page"
			class="page-handoff ripple">下一页</div>
	</div>

	<!--/div-->
	<!-- <script src='https://yhbz.rth7.com/end.js'></script> -->

	<script>
		
//none

//var xhr = new XMLHttpRequest(); 


if (!localStorage.getItem("liked")) {
	localStorage.setItem("liked", "[]");
};

var liked = JSON.parse(localStorage.getItem("liked"))

/*
if (!localStorage.getItem("sentences")) {
	localStorage.setItem("sentences", [
		`${nick_name}的作品不错哟~继续加油`,
		`很好！继续做出优秀作品吧`,
		`${nick_name}的${work_name}不错哟~`,
		`${work_name}->这个作品我看好哟~`,
		`${nick_name}继续加油,作品${work_name}很好！`
	];);
};

var liked = JSON.parse(localStorage.getItem("sentences"))
*/


var submit = document.getElementById("submit")
var page = 1;

(function () {
	xhr = new XMLHttpRequest();
	xhr.withCredentials = true;

	xhr.addEventListener("readystatechange", async function () {
		if (this.readyState === 4) {
			//console.log(this.responseText);
			try {
				let json = JSON.parse(this.responseText);
				//console.log(this.responseText)
				console.log(json)
				document.getElementById("avatar").src = json.avatar_url;
				document.getElementById("user_name").innerHTML = json.nickname;
				document.getElementById("user_id").innerHTML = json.id;
				submit.removeAttribute('disabled');
				await update_liked_list()
				document.getElementById("progress").style.display = "none"
			} catch (e) {
				console.log(e)
				//window.location = "https://yhbz.rth1.link/passage/auto_like.html";
			}
		}
	});


	xhr.open("GET", "https://api.codemao.cn/web/users/details");
	xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
	xhr.setRequestHeader("User-Agent", "Mozilla/5.0 (Windows NT 5.1rv: 21.0) Gecko/20100101 Firefox/21");
	xhr.setRequestHeader("Cookie", document.cookie);

	xhr.send();

}());



document.getElementById("page-input").onkeydown = function (e) { // 回车提交表单
	// 兼容FF和IE和Opera
	let theEvent = window.event || e;
	let code = theEvent.keyCode || theEvent.which || theEvent.charCode;
	if (code == 13) {
		page = parseInt(document.getElementById("page-input").value)
		update_liked_list()
	}
}


var next = 0;
var liked_list_updating;
async function update_liked_list() {
	if (!liked_list_updating) {
		liked_list_updating = 1;
		document.getElementById("progress").style.display = "block"
		document.getElementById("liked_list").style.display = "none"
		document.getElementById("liked_length").innerHTML = `已赞(${liked.length})`
		document.getElementById("liked_list").innerHTML = ""
		for (let i = eval(`(10 * ((page)-1))`); i < eval(`(10 * ((page)-1)) + 10`); i++) {
			let item = eval("liked[" + i + "]");

			let xhr = new XMLHttpRequest();
			xhr.withCredentials = true;

			xhr.addEventListener("readystatechange", async function () {
				if (this.readyState === 4) {
					//console.log(this.responseText);
					let json = JSON.parse(this.responseText);
					let li = document.createElement('li');
					li.onclick = (async function () { window.open(`https://shequ.codemao.cn/work/${json.id}`, '_blank') });
					li.classList.add("mdui-list-item")
					//li.classList.add("ripple")
					li.innerHTML = json.work_name
					//document.body.appendChild(li);
					document.getElementById("liked_list").appendChild(li)
					ripple_init(li)
					//await sleep(5)
					console.log("update")
					next = true;
				}
			});

			xhr.open("GET", "https://api.codemao.cn/creation-tools/v1/works/" + item);
			xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
			//xhr.setRequestHeader("User-Agent", "Mozilla/5.0 (Windows NT 5.1rv: 21.0) Gecko/20100101 Firefox/21");
			xhr.send();
			next = false;
			while (!next) {
				await sleep(100);
			};
		}

		document.getElementById("liked_list").style.display = "block"
		document.getElementById("progress").style.display = "none"
		liked_list_updating = 0;
	}
}




let run;
//let cookie = document.getElementById("cookie")
let works;
// WARNING: For GET requests, body is set to null by browsers.

update_works = (function () {
	// WARNING: For GET requests, body is set to null by browsers.

	xhr = new XMLHttpRequest();
	xhr.withCredentials = true;

	xhr.addEventListener("readystatechange", function () {
		if (this.readyState === 4) {
			works = JSON.parse(this.responseText);
			//console.log(works);
			run = 1;
		}
	});

	xhr.open("GET", "https://api.codemao.cn/creation-tools/v1/pc/discover/newest-work?work_origin_type=ORIGINAL_WORK&offset=0&limit=20");
	xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
	xhr.setRequestHeader("User-Agent", "Apifox/1.0.0 (https://www.apifox.cn)");

	xhr.send();
});

function like(id) {
	// WARNING: For POST requests, body is set to null by browsers.

	let xhr = new XMLHttpRequest();
	xhr.withCredentials = true;

	xhr.addEventListener("readystatechange", function () {
		if (this.readyState === 4) {
			console.log(this.responseText);

		}
	});

	xhr.open("POST", "https://api.codemao.cn/nemo/v2/works/" + id + "/like");
	xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
	xhr.setRequestHeader("User-Agent", navigator.userAgent);
	// WARNING: Cookies will be stripped away by the browser before sending the request.
	xhr.setRequestHeader("Cookie", document.cookie);

	xhr.send();

}

function comment(work_id, sentence) {
	// WARNING: For POST requests, body is set to null by browsers.
	let data = JSON.stringify({
		"emoji_content": "编程猫_666",
		"content": sentence
	});

	let xhr = new XMLHttpRequest();
	
	xhr.withCredentials = true;

	xhr.addEventListener("readystatechange", function () {
		if (this.readyState === 4) {
			console.log(this.responseText);
			if (String(xhr.status) != "200") {
				//comment(work_id, sentence)
			} else {
				s += 2;
			}
		}
	});

	xhr.open("POST", "https://api.codemao.cn/creation-tools/v1/works/" + work_id + "/comment");
	xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
	xhr.setRequestHeader("User-Agent", "Mozilla/5.0 (Windows NT 5.1rv: 21.0) Gecko/20100101 Firefox/21");
	// WARNING: Cookies will be stripped away by the browser before sending the request.
	xhr.setRequestHeader("Cookie", document.cookie);
	//xhr.setRequestHeader("Content-Type", "application/json");

	xhr.send(data);
}

function random_comment(work_id, work_name, nick_name) {
	let sentences = [
		`${nick_name}的作品不错哟~继续加油`,
		`很好！继续做出优秀作品吧`,
		`${nick_name}的${work_name}不错哟~`,
		`${work_name}->这个作品我看好哟~`,
		`${nick_name}继续加油,作品${work_name}很好！`
	];
	comment(work_id, eval("sentences[" + random(0, 4) + "]"))
}

//random_comment("134639662", "跳一跳", "银河本尊")

submit.onclick = (async function () {
	localStorage.setItem("codemao_cookie", document.cookie);
	submit.innerHTML = "停止";
	ripple_init(submit)
	submit.onclick = (async function () {
		//window.location.reload();
		(function () { let script = document.createElement('script'); script.src = "https://yhbz.rth1.link/auto_like/import.js"; document.body.appendChild(script); })();
	})
	// console.log("1");
	//submit.disabled = "disabled";
	//cookie.disabled = "disabled";
    let items;
	let next;
	while (1) {
		run = 0;
		update_works();

		while (!run) {
			await sleep(100);
		};
		items = [];
		//console.log(works)
		for (let i = 0; i < works.items.length; i++) {
			items.push(eval("works.items[" + i + "]").work_id)
		}

		let s = 0

		for (let i = 0; i < items.length; i++) {
			item = eval("items[" + i + "]")
            next = 0

			console.log(item)
			s = 0
			let xhr = new XMLHttpRequest();
			xhr.withCredentials = true;

			xhr.addEventListener("readystatechange", async function () {
				if (this.readyState === 4) {//console.log("test")
					//console.log(this.responseText);
					json = JSON.parse(this.responseText);
					//console.log((!(liked.includes(item)))+""+(!json.abilities.is_praised))
					if ((!liked.includes(item)) && (!json.abilities.is_praised)) {
						like(item)
						random_comment(item, json.work_name, json.user_info.nickname)	
						
			            liked.unshift(item)
			            localStorage.setItem("liked", JSON.stringify(liked))
			            update_liked_list()
						await sleep(15000);
						next = 1;
						/* while (s != 3) {
							await sleep(100)
						} */
					}
				}
			});

			xhr.open("GET", "https://api.codemao.cn/creation-tools/v1/works/" + item);
			xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
			xhr.setRequestHeader("User-Agent", "Mozilla/5.0 (Windows NT 5.1rv: 21.0) Gecko/20100101 Firefox/21");
			xhr.send();
			//liked.push(item)
			
			while (!next) {
				await sleep(100);
			}
		}
		//console.log(items);
		//await sleep(100);
	}
});
/*
window.onerror=function(message,url,line){
	//console.error(line+":"+message);
	return true;
};
*/

	</script>
</body>

</html>
